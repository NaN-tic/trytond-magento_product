<?xml version="1.0"?>
<!-- This file is part magento_manufacturer module for Tryton.
The COPYRIGHT file at the top level of this repository contains the full copyright notices and license terms. -->
<tryton>
    <!-- Base External Mapping -->
    <data noupdate="1" skiptest="1">
        <record model="base.external.mapping" id="magento_base_external_mapping_template">
            <field name="name">magento.product.template</field>
            <field name="model" search="[('model', '=', 'product.template')]"/>
            <field name="state">done</field>
        </record>
        <record model="base.external.mapping" id="magento_base_external_mapping_product">
            <field name="name">magento.product.product</field>
            <field name="model" search="[('model', '=', 'product.product')]"/>
            <field name="state">done</field>
        </record>
    </data>

    <!-- Base External Mapping Lines -->
    <data noupdate="1" skiptest="1" grouped="1">
        <!-- Template -->
        <record model="base.external.mapping.line" id="magento_base_external_mapping_line_meta_description">
            <field name="mapping" ref="magento_base_external_mapping_template"/>
            <field name="field" search="[('model.model', '=', 'product.template'), ('name', '=', 'esale_metadescription')]"/>
            <field name="external_field">meta_description</field>
            <field name="mapping_type">in_out</field>
            <field name="external_type">str</field>
            <field name="active">True</field>
            <field name="in_function">result = value
if value and len(value) > 155:
    result =  '%s...' % (value[:152])</field>
            <field name="out_function"></field>
        </record>
        <record model="base.external.mapping.line" id="magento_base_external_mapping_line_esale_metakeyword">
            <field name="mapping" ref="magento_base_external_mapping_template"/>
            <field name="field" search="[('model.model', '=', 'product.template'), ('name', '=', 'esale_metakeyword')]"/>
            <field name="external_field">meta_keyword</field>
            <field name="mapping_type">in_out</field>
            <field name="external_type">str</field>
            <field name="active">True</field>
            <field name="in_function">result = value
if value and len(value) > 155:
    result =  '%s...' % (value[:152])</field>
        </record>
        <record model="base.external.mapping.line" id="magento_base_external_mapping_line_esale_metatitle">
            <field name="mapping" ref="magento_base_external_mapping_template"/>
            <field name="field" search="[('model.model', '=', 'product.template'), ('name', '=', 'esale_metatitle')]"/>
            <field name="external_field">meta_title</field>
            <field name="mapping_type">in_out</field>
            <field name="external_type">str</field>
            <field name="active">True</field>
            <field name="in_function">result = value
if value and len(value) > 155:
    result =  '%s...' % (value[:152])</field>
            <field name="out_function"></field>
        </record>
        <record model="base.external.mapping.line" id="magento_base_external_mapping_line_esale_description">
            <field name="mapping" ref="magento_base_external_mapping_template"/>
            <field name="field" search="[('model.model', '=', 'product.template'), ('name', '=', 'esale_description')]"/>
            <field name="external_field">description</field>
            <field name="mapping_type">in_out</field>
            <field name="external_type">str</field>
            <field name="active">True</field>
            <field name="out_function">from wikimarkup import parse
product, = pool.get('product.template').read([record], ['esale_description'])
description = product['esale_description']
result = parse(description)</field>
        </record>
        <record model="base.external.mapping.line" id="magento_base_external_mapping_line_cost_price">
            <field name="mapping" ref="magento_base_external_mapping_template"/>
            <field name="field" search="[('model.model', '=', 'product.template'), ('name', '=', 'cost_price')]"/>
            <field name="external_field">cost</field>
            <field name="mapping_type">in</field>
            <field name="external_type">str</field>
            <field name="active">True</field>
            <field name="in_function">if value:
    result = value
else:
    result = values['price']</field>
        </record>
        <record model="base.external.mapping.line" id="magento_base_external_mapping_line_name">
            <field name="mapping" ref="magento_base_external_mapping_template"/>
            <field name="field" search="[('model.model', '=', 'product.template'), ('name', '=', 'name')]"/>
            <field name="external_field">name</field>
            <field name="mapping_type">in_out</field>
            <field name="external_type">str</field>
            <field name="active">True</field>
        </record>
        <record model="base.external.mapping.line" id="magento_base_external_mapping_line_list_price">
            <field name="mapping" ref="magento_base_external_mapping_template"/>
            <field name="field" search="[('model.model', '=', 'product.template'), ('name', '=', 'list_price')]"/>
            <field name="external_field">price</field>
            <field name="mapping_type">in</field>
            <field name="external_type">str</field>
            <field name="active">True</field>
        </record>
        <record model="base.external.mapping.line" id="magento_base_external_mapping_line_esale_shortdescription">
            <field name="mapping" ref="magento_base_external_mapping_template"/>
            <field name="field" search="[('model.model', '=', 'product.template'), ('name', '=', 'esale_shortdescription')]"/>
            <field name="external_field">short_description</field>
            <field name="mapping_type">in_out</field>
            <field name="external_type">str</field>
            <field name="active">True</field>
            <field name="out_function">from wikimarkup import parse
product, = pool.get('product.template').read([record], ['esale_shortdescription'])
shortdescription = product['esale_shortdescription']
result = parse(shortdescription)</field>
        </record>
        <record model="base.external.mapping.line" id="magento_base_external_mapping_line_esale_active">
            <field name="mapping" ref="magento_base_external_mapping_template"/>
            <field name="field" search="[('model.model', '=', 'product.template'), ('name', '=', 'esale_active')]"/>
            <field name="external_field">status</field>
            <field name="mapping_type">in_out</field>
            <field name="external_type">str</field>
            <field name="active">True</field>
            <field name="in_function">result = True
if value == '2':
    result = False</field>
        </record>
        <record model="base.external.mapping.line" id="magento_base_external_mapping_line_esale_slug">
            <field name="mapping" ref="magento_base_external_mapping_template"/>
            <field name="field" search="[('model.model', '=', 'product.template'), ('name', '=', 'esale_slug')]"/>
            <field name="external_field">url_key</field>
            <field name="mapping_type">in_out</field>
            <field name="external_type">str</field>
            <field name="active">True</field>
        </record>
        <record model="base.external.mapping.line" id="magento_base_external_mapping_line_esale_visibility">
            <field name="mapping" ref="magento_base_external_mapping_template"/>
            <field name="field" search="[('model.model', '=', 'product.template'), ('name', '=', 'esale_visibility')]"/>
            <field name="external_field">visibility</field>
            <field name="mapping_type">in_out</field>
            <field name="external_type">str</field>
            <field name="active">True</field>
            <field name="in_function">if value == '1':
    result = 'none'
elif value == '2':
    result = 'catalog'
elif value == '3':
    result = 'search'
else:
    result = 'all'</field>
            <field name="out_function">product, = pool.get('product.template').read([record], ['esale_visibility'])
visibility = product['esale_visibility']

if visibility ==  'none':
    result = '1'
elif visibility == 'catalog':
    result = '2'
elif visibility == 'search':
    result = '3'
else:
    result = '4'</field>
        </record>
        <record model="base.external.mapping.line" id="magento_base_external_mapping_line_esale_attribute_group">
            <field name="mapping" ref="magento_base_external_mapping_template"/>
            <field name="field" search="[('model.model', '=', 'product.template'), ('name', '=', 'esale_attribute_group')]"/>
            <field name="external_field">set</field>
            <field name="mapping_type">in</field>
            <field name="external_type">str</field>
            <field name="active">True</field>
            <field name="in_function">result = 1 #ID default attribute</field>
            <field name="out_function">result = '4' #ID default attribute</field>
        </record>
        <record model="base.external.mapping.line" id="magento_base_external_mapping_line_esale_available">
            <field name="mapping" ref="magento_base_external_mapping_template"/>
            <field name="field" search="[('model.model', '=', 'product.template'), ('name', '=', 'esale_available')]"/>
            <field name="external_field">status</field>
            <field name="mapping_type">in</field>
            <field name="external_type">str</field>
            <field name="active">True</field>
            <field name="in_function">result = True</field>
        </record>
        <record model="base.external.mapping.line" id="magento_base_external_mapping_line_magento_product_type">
            <field name="mapping" ref="magento_base_external_mapping_template"/>
            <field name="field" search="[('model.model', '=', 'product.template'), ('name', '=', 'magento_product_type')]"/>
            <field name="external_field">type_id</field>
            <field name="mapping_type">in</field>
            <field name="external_type">str</field>
            <field name="active">True</field>
        </record>
        <record model="base.external.mapping.line" id="magento_base_external_mapping_line_special_price">
            <field name="mapping" ref="magento_base_external_mapping_template"/>
            <field name="field" search="[('model.model', '=', 'product.template'), ('name', '=', 'special_price')]"/>
            <field name="external_field">special_price</field>
            <field name="mapping_type">in_out</field>
            <field name="external_type">str</field>
            <field name="active">True</field>
        </record>
        <record model="base.external.mapping.line" id="magento_base_external_mapping_line_special_price_from">
            <field name="mapping" ref="magento_base_external_mapping_template"/>
            <field name="field" search="[('model.model', '=', 'product.template'), ('name', '=', 'special_price_from')]"/>
            <field name="external_field">special_from_date</field>
            <field name="mapping_type">in</field>
            <field name="external_type">str</field>
            <field name="active">True</field>
            <field name="in_function">result = None
if value:
    import datetime
    d = '%s 00:00:00' % (value[:10]) #remove H:M:D
    result = datetime.datetime.strptime(d, "%Y-%m-%d %H:%M:%S")</field>
        </record>
        <record model="base.external.mapping.line" id="magento_base_external_mapping_line_special_price_to">
            <field name="mapping" ref="magento_base_external_mapping_template"/>
            <field name="field" search="[('model.model', '=', 'product.template'), ('name', '=', 'special_price_to')]"/>
            <field name="external_field">special_to_date</field>
            <field name="mapping_type">in</field>
            <field name="external_type">str</field>
            <field name="active">True</field>
            <field name="in_function">result = None
if value:
    import datetime
    d = '%s 00:00:00' % (value[:10]) #remove H:M:D
    result = datetime.datetime.strptime(d, "%Y-%m-%d %H:%M:%S")</field>
        </record>

        <!-- Product -->
        <record model="base.external.mapping.line" id="magento_base_external_mapping_line_code">
            <field name="mapping" ref="magento_base_external_mapping_product"/>
            <field name="field" search="[('model.model', '=', 'product.product'), ('name', '=', 'code')]"/>
            <field name="external_field">sku</field>
            <field name="mapping_type">in_out</field>
            <field name="external_type">str</field>
            <field name="active">True</field>
        </record>
        <record model="base.external.mapping.line" id="magento_base_external_mapping_line_attributes">
            <field name="mapping" ref="magento_base_external_mapping_product"/>
            <field name="field" search="[('model.model', '=', 'product.product'), ('name', '=', 'attributes')]"/>
            <field name="external_field">tax_class_id</field>
            <field name="mapping_type">in_out</field>
            <field name="external_type">str</field>
            <field name="active">True</field>
        </record>
    </data>
</tryton>
